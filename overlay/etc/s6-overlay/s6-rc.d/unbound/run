#!/usr/bin/nu-env

use bf
use bf-s6
use bf-unbound
bf-s6 env set_executable unbound

# Start Unbound daemon
def main [...args] {
    # pre-flight checks
    bf-unbound update anchor
    bf-unbound check conf

    # start Unbound
    bf write "Starting Unbound in daemon mode."
    s6-setuidgid unbound unbound -c (bf env req UNBOUND_CONF) -d
}
